// Unit tests

'use strict'
var board_t = require('./board.js').board_t

function test_moves() {
  console.log('  test moves')
  // Check move generation.  Test vectors generated by 'pentago/web/generate moves'
  var moves = {"1011624752379795672":["1011624752379795673m","1011624752379861208m","1011624752379992280m","1011624752380385496m","1011624752379795753m","1011624752379802233m","1011624752523122904m","1011624756674762968m","1011906227356506328m","1014158027170191576m","1011625796056848600m","1011634145473272024m","1011652931660224728m","2858382074578409688m"],"2229312834711074147m":["2229312834711066579","2229312834711066363","2229312834360849763","2229312834332538211","2229333691072263523","2229285827956716899","3307924945466307939","3105262962234635619"],"2410287384723724724":["2410287384723724730m","2410287384724904372m","2410287384723724778m","2410287384723724886m","2410287384723725210m","2410287384723726182m","2410287384723729098m","2410287384819276212m","2415353934304516532m","2410287616651958708m","2455886330950850996m","2410343743284582836m","3641458932856134068m"],"5066549596918038":["5066549596918039m","5066549596918041m","5066549596918047m","5066549596983574m","5066549597507862m","5066549596918065m","5066549596918119m","5066549596918281m","5066549598687510m","5066549602226454m","5066549596918767m","5066549596924599m","5066549644693782m","5066549740245270m","5066550026899734m","5066553891885334m","5066562481819926m","5066588251623702m","5348024573628694m","5910974527050006m","5066665561035030m","5066897489269014m","5067593273970966m","12666373968105750m","27866022710481174m","73464968937607446m","5069680628076822m","5075942690394390m","5094728877347094m","210261807618986262m","620652323663122710m","1851823871795532054m"],"695784702278m":["695784704238","695784703494","695784702278","695784702278","695784702278","695784702278","695784702278","695784702278"],"116043743247":["116043743249m","116043874319m","116044136463m","116044922895m","116043743301m","116043743409m","116043743733m","116047282191m","116054360079m","116043744705m","116043747621m","116043756369m","116330397711m","116903706639m","124633677839m","141813547023m","193353154575m","563065997164559m","1688965904007183m","5066665624535055m","811828445199m","2203397849103m","15199764786118671m","45599062270869519m","136796954725122063m","6378106060815m","18902230695951m","56474604601359m","410390632087879695m","1231171664176152591m","3693514760440971279m"],"6561":["6563m","6567m","6579m","137633m","399777m","1186209m","6615m","6723m","7047m","3545505m","10623393m","31857057m","8019m","10935m","95558049m","286661025m","859969953m","8589941153m","25769810337m","77309417889m","562949953427873m","1688849860270497m","5066549580798369m","231928240545m","695784708513m","2087354112417m","15199648742381985m","45598946227132833m","136796838681385377m","6262062324129m","18786186959265m","56358560864673m","410390516044143009m","1231171548132415905m","3693514644397234593m"],"27m":["3","2187","27","27","27","27","27","27"],
               "5240011396720247894m":["5240011396720250046","5240011396720249110","5240011396352722006","5240011396481696854","5239983221734786134","5240008304343794774","2983707983407629398","3456585944281531478"],"3319782709752515159m":["3319782709752511031","3319782709752515615","3319782709387086423","3319782709420116567","3319759826166762071","3319717013932755543","4008833452740201047","2837897549623872087"],"0":["1m","3m","9m","65536m","196608m","589824m","27m","81m","243m","1769472m","5308416m","15925248m","729m","2187m","6561m","47775744m","143327232m","429981696m","4294967296m","12884901888m","38654705664m","281474976710656m","844424930131968m","2533274790395904m","115964116992m","347892350976m","1043677052928m","7599824371187712m","22799473113563136m","68398419340689408m","3131031158784m","9393093476352m","28179280429056m","205195258022068224m","615585774066204672m","1846757322198614016m"],"4650857499503509072":["4650857499503510530m"],"2977807845258379295":[],"4853554035756516105m":["4853554035756509761","4853554035756517569","4853554036313834249","4853554035787973385","4853528987507245833","4853525895130792713","3070128583317799689","5470547184706274057"],"214483932253520763m":["214483932253520035","214483932253526595","214483932253520763","214483932253520763","214483932253520763","214483932253520763","137922738588222331","2477542745007195003"]}
  for (var name in moves) {
    var board = new board_t(name)
    var same = new board_t(board.quads,board.middle)
    if (board.name != name || same.name != name)
      throw 'name inconsistency: name '+name+', same '+same.name
    var correct = moves[name]
    var computed = board.moves().map(function (b) { return b.name })
    if (correct+'' != computed+'')
      throw 'move computation failed: board '+name+', correct '+correct.length+', computed '+computed.length
        +'\n  correct  '+correct+'\n  computed '+computed
  }
}

function test_done() {
  console.log('  test done')
  // Check win testing.  Test vectors generated by 'pentago/web/generate done'
  var done = {"2976116293746967357m":0,"5304438607310040937m":-1,"5301073547195600085m":0,"615585774066204672m":2,"2778485976389143769m":1,"3857927569745789080":-1,"2773737898589307144":0,"5506266241607018947":0,"3475171294457643039":0,"3555673296132188499m":0,"4479740444800790635m":1,"2863773010437156884m":0,"4915721660620491404":1,"5513575159699286624":-1,"3484715119375764459m":-1,"5383810007010775334m":2,"3047040244199401895":1,"1820908466345429404m":0,"5308363550859340431m":1,"0":2,"5440121602007517701":-1,"2772893009557406690":1,"382205956m":2,"5509381261089579968":-1,"5311766062048620806":-1,"5256035348086992727m":0,"3591986351240006035m":1,"846512714219526":2,"3000596962679079992m":-1,"2577788820565331679":2,"3465284936442202359":-1,"3621249557000890086":1,"3456596200371988337":1,"5516964335215711915m":1,"3465030906558031800m":-1,"2780175306852223496":0,"4650575315570543724":2,"5327250561997350523":0,"4822000573755114463":-1,"2795371322632907188":-1,"15199649173537011m":2,"4890417868906710102":1,"752382844691939328":2,"1769472":2,"3591142244601185006m":1}
  for (var name in done) {
    var board = new board_t(name)
    var v = board.done() ? board.immediate_value() : 2
    if (v != done[name])
      throw 'done check failed: board '+name+', correct '+done[name]+', got '+v
  }
}

// Run all tests
test_moves()
test_done()
var green = '\x1b[1;32m'
var clear = '\x1b[00m'
console.log(green+'  all tests passed'+clear)
